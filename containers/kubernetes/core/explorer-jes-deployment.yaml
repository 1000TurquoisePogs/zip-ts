################################################################################
# This program and the accompanying materials are made available under the terms of the
# Eclipse Public License v2.0 which accompanies this distribution, and is available at
# https://www.eclipse.org/legal/epl-v20.html
#
# SPDX-License-Identifier: EPL-2.0
#
# Copyright Contributors to the Zowe Project.
################################################################################

---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: explorer-jes
  labels:
    app: zowe
spec:
  selector:
    matchLabels:
      app: zowe
      tier: explorer-jes
  replicas: 1
  template:
    metadata:
      labels:
        app: zowe
        tier: explorer-jes
    spec:
      volumes:
        - name: zowe-instance
          emptyDir: {}
        - name: zowe-runtime
          emptyDir: {}
        - name: zowe-config
          configMap:
            name: zowe-config
        - name: zowe-certificates-cm
          configMap:
            name: zowe-certificates-cm
        - name: zowe-certificates-secret
          secret:
            secretName: zowe-certificates-secret
        - name: zowe-workspace
          persistentVolumeClaim:
            claimName: zowe-workspace-claim
      containers:
        - name: explorer-jes
          image: zowe-docker-release.jfrog.io/ompzowe/explorer-jes:latest
          resources:
            requests:
              memory: "64Mi"
              cpu: "100m"
            limits:
              memory: "128Mi"
              cpu: "250m"
          ports:
            - containerPort: 8080
          command: ["/home/zowe/instance/bin/internal/run-zowe.sh"]
          volumeMounts:
            - name: zowe-runtime
              mountPath: "/home/zowe/runtime"
            - name: zowe-instance
              mountPath: "/home/zowe/instance"
            - name: zowe-config
              mountPath: "/home/zowe/instance/instance.env"
              subPath: instance.env
              readOnly: true
            - name: zowe-certificates-cm
              mountPath: "/home/zowe/keystore/zowe-certificates.env"
              subPath: zowe-certificates.env
              readOnly: true
            - name: zowe-certificates-secret
              mountPath: "/home/zowe/keystore"
              readOnly: true
            - name: zowe-workspace
              mountPath: "/home/zowe/instance/workspace"
      initContainers:
        - name: init-zowe
          image: zowe-docker-snapshot.jfrog.io/ompzowe/zowe-launch-scripts:0.0.1-ubuntu.users-jack-k8s-yaml-22
          volumeMounts:
            - name: zowe-runtime
              mountPath: "/home/zowe/runtime"
            - name: zowe-instance
              mountPath: "/home/zowe/instance"
